<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies</title>
    <script src="https://unpkg.com/htmx.org"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/client-side-templates.js"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
    <script src="https://unpkg.com/mustache"></script>
</head>

<body>
    <div hx-ext="client-side-templates">
        <h1>
            Movies
        </h1>

        <h2>Add a new movie</h2>
        <form hx-post="/movies" hx-ext="json-enc" hx-trigger="submit" hx-target="#movieRows" hx-swap="afterbegin" mustache-template="movie">
            <label for="imdb_id">IMDbId</label>
            <input id="imdb_id" type="string" name="imdb_id" placeholder="tt0000001" minlength="9" maxlength="9" required>

            <label for="title">Title</label>
            <input id="title" type="text" name="title" minlength="1" maxlength="255" placeholder="A movie title" required>

            <label for="rating">IMDbRating</label>
            <input id="rating" type="number" step="0.1" min="1" max="10" name="rating" placeholder="1.0-10.0" required>

            <label for="year">Release Year</label>
            <input id="year" type="number" name="year" min="1" max="9999" placeholder="2023" required>

            <button type="submit">Submit</button>
        </form>

        <table>
            <thead>
                <tr>
                    <th>IMDbId</th>
                    <th>Title</th>
                    <th>Rating</th>
                    <th>Plot</th>
                </tr>
            </thead>
            <tbody id="movieRows" hx-get="/movies" hx-trigger="load" hx-swap="innerHTML" mustache-array-template="movies"></tbody>
        </table>

        <template id="movies">
            {{ #data }}
            <tr>
                <td>{{ imdb_id }}</td>
                <td>{{ title }} ({{ year }})</td>
                <td>{{ rating }}</td>
                <td>{{ plot }}</td>
            </tr>
            {{ /data }}
        </template>

        <template id="movie">
            <tr>
                <td>{{ imdb_id }}</td>
                <td>{{ title }} ({{ year }})</td>
                <td>{{ rating }}</td>
                <td>{{ plot }}</td>
            </tr>
        </template>
    </div>
</body>

</html>